export const resampleWaveForm = (waveFormData, sampleSize) => {
    return waveFormData.length > sampleSize
        ? downsample(waveFormData, sampleSize)
        : upsample(waveFormData, sampleSize);
};
const downsample = (waveFormData, sampleSize) => {
    if (waveFormData.length <= sampleSize) {
        return waveFormData;
    }
    if (sampleSize === 1)
        return [mean(waveFormData)];
    const result = [];
    // bucket size adjusted due to the fact that the first and the last item in the original data array is kept in target output
    const bucketSize = (waveFormData.length - 2) / (sampleSize - 2);
    let lastSelectedPointIndex = 0;
    result.push(waveFormData[lastSelectedPointIndex]); // Always add the first point
    let maxAreaPoint, maxArea, triangleArea;
    for (let bucketIndex = 1; bucketIndex < sampleSize - 1; bucketIndex++) {
        const previousBucketRefPoint = waveFormData[lastSelectedPointIndex];
        const nextBucketMean = getNextBucketMean(waveFormData, bucketIndex, bucketSize);
        const currentBucketStartIndex = Math.floor((bucketIndex - 1) * bucketSize) + 1;
        const nextBucketStartIndex = Math.floor(bucketIndex * bucketSize) + 1;
        const countUnitsBetweenAtoC = 1 + nextBucketStartIndex - currentBucketStartIndex;
        maxArea = triangleArea = -1;
        for (let currentPointIndex = currentBucketStartIndex; currentPointIndex < nextBucketStartIndex; currentPointIndex++) {
            const countUnitsBetweenAtoB = Math.abs(currentPointIndex - currentBucketStartIndex) + 1;
            const countUnitsBetweenBtoC = countUnitsBetweenAtoC - countUnitsBetweenAtoB;
            const currentPointValue = waveFormData[currentPointIndex];
            triangleArea = triangleAreaHeron(triangleBase(Math.abs(previousBucketRefPoint - currentPointValue), countUnitsBetweenAtoB), triangleBase(Math.abs(currentPointValue - nextBucketMean), countUnitsBetweenBtoC), triangleBase(Math.abs(previousBucketRefPoint - nextBucketMean), countUnitsBetweenAtoC));
            if (triangleArea > maxArea) {
                maxArea = triangleArea;
                maxAreaPoint = waveFormData[currentPointIndex];
                lastSelectedPointIndex = currentPointIndex;
            }
        }
        if (typeof maxAreaPoint !== 'undefined')
            result.push(maxAreaPoint);
    }
    result.push(waveFormData[waveFormData.length - 1]); // Always add the last point
    return result;
};
const upsample = (waveFormData, sampleSize) => {
    if (sampleSize === waveFormData.length)
        return waveFormData;
    // eslint-disable-next-line  prefer-const
    let [bucketSize, remainder] = divMod(sampleSize, waveFormData.length);
    const result = [];
    for (let i = 0; i < waveFormData.length; i++) {
        const extra = remainder && remainder-- ? 1 : 0;
        result.push(...Array(bucketSize + extra).fill(waveFormData[i]));
    }
    return result;
};
const getNextBucketMean = (data, currentBucketIndex, bucketSize) => {
    const nextBucketStartIndex = Math.floor(currentBucketIndex * bucketSize) + 1;
    let nextNextBucketStartIndex = Math.floor((currentBucketIndex + 1) * bucketSize) + 1;
    nextNextBucketStartIndex =
        nextNextBucketStartIndex < data.length
            ? nextNextBucketStartIndex
            : data.length;
    return mean(data.slice(nextBucketStartIndex, nextNextBucketStartIndex));
};
const mean = (values) => values.reduce((acc, value) => acc + value, 0) / values.length;
const triangleAreaHeron = (a, b, c) => {
    const s = (a + b + c) / 2;
    return Math.sqrt(s * (s - a) * (s - b) * (s - c));
};
const triangleBase = (a, b) => Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
const divMod = (num, divisor) => {
    return [Math.floor(num / divisor), num % divisor];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2F2ZS1mb3JtLXNhbXBsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9zdHJlYW0tY2hhdC1hbmd1bGFyL3NyYy9saWIvd2F2ZS1mb3JtLXNhbXBsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FDOUIsWUFBc0IsRUFDdEIsVUFBa0IsRUFDbEIsRUFBRTtJQUNGLE9BQU8sWUFBWSxDQUFDLE1BQU0sR0FBRyxVQUFVO1FBQ3JDLENBQUMsQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQztRQUN0QyxDQUFDLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN6QyxDQUFDLENBQUM7QUFFRixNQUFNLFVBQVUsR0FBRyxDQUFDLFlBQXNCLEVBQUUsVUFBa0IsRUFBRSxFQUFFO0lBQ2hFLElBQUksWUFBWSxDQUFDLE1BQU0sSUFBSSxVQUFVLEVBQUU7UUFDckMsT0FBTyxZQUFZLENBQUM7S0FDckI7SUFFRCxJQUFJLFVBQVUsS0FBSyxDQUFDO1FBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBRWxELE1BQU0sTUFBTSxHQUFhLEVBQUUsQ0FBQztJQUM1Qiw0SEFBNEg7SUFDNUgsTUFBTSxVQUFVLEdBQUcsQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLElBQUksc0JBQXNCLEdBQUcsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLDZCQUE2QjtJQUNoRixJQUFJLFlBQVksRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDO0lBRXhDLEtBQUssSUFBSSxXQUFXLEdBQUcsQ0FBQyxFQUFFLFdBQVcsR0FBRyxVQUFV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R0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BELENBQUMsQ0FBQztBQUVGLE1BQU0sWUFBWSxHQUFHLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBRSxFQUFFLENBQzVDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUU3QyxNQUFNLE1BQU0sR0FBRyxDQUFDLEdBQVcsRUFBRSxPQUFlLEVBQUUsRUFBRTtJQUM5QyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEVBQUUsR0FBRyxHQUFHLE9BQU8sQ0FBQyxDQUFDO0FBQ3BELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCByZXNhbXBsZVdhdmVGb3JtID0gKFxuICB3YXZlRm9ybURhdGE6IG51bWJlcltdLFxuICBzYW1wbGVTaXplOiBudW1iZXJcbikgPT4ge1xuICByZXR1cm4gd2F2ZUZvcm1EYXRhLmxlbmd0aCA+IHNhbXBsZVNpemVcbiAgICA/IGRvd25zYW1wbGUod2F2ZUZvcm1EYXRhLCBzYW1wbGVTaXplKVxuICAgIDogdXBzYW1wbGUod2F2ZUZvcm1EYXRhLCBzYW1wbGVTaXplKTtcbn07XG5cbmNvbnN0IGRvd25zYW1wbGUgPSAod2F2ZUZvcm1EYXRhOiBudW1iZXJbXSwgc2FtcGxlU2l6ZTogbnVtYmVyKSA9PiB7XG4gIGlmICh3YXZlRm9ybURhdGEubGVuZ3RoIDw9IHNhbXBsZVNpemUpIHtcbiAgICByZXR1cm4gd2F2ZUZvcm1EYXRhO1xuICB9XG5cbiAgaWYgKHNhbXBsZVNpemUgPT09IDEpIHJldHVybiBbbWVhbih3YXZlRm9ybURhdGEpXTtcblxuICBjb25zdCByZXN1bHQ6IG51bWJlcltdID0gW107XG4gIC8vIGJ1Y2tldCBzaXplIGFkanVzdGVkIGR1ZSB0byB0aGUgZmFjdCB0aGF0IHRoZSBmaXJzdCBhbmQgdGhlIGxhc3QgaXRlbSBpbiB0aGUgb3JpZ2luYWwgZGF0YSBhcnJheSBpcyBrZXB0IGluIHRhcmdldCBvdXRwdXRcbiAgY29uc3QgYnVja2V0U2l6ZSA9ICh3YXZlRm9ybURhdGEubGVuZ3RoIC0gMikgLyAoc2FtcGxlU2l6ZSAtIDIpO1xuICBsZXQgbGFzdFNlbGVjdGVkUG9pbnRJbmRleCA9IDA7XG4gIHJlc3VsdC5wdXNoKHdhdmVGb3JtRGF0YVtsYXN0U2VsZWN0ZWRQb2ludEluZGV4XSk7IC8vIEFsd2F5cyBhZGQgdGhlIGZpcnN0IHBvaW50XG4gIGxldCBtYXhBcmVhUG9pbnQsIG1heEFyZWEsIHRyaWFuZ2xlQXJlYTtcblxuICBmb3IgKGxldCBidWNrZXRJbmRleCA9IDE7IGJ1Y2tldEluZGV4IDwgc2FtcGxlU2l6ZSAtIDE7IGJ1Y2tldEluZGV4KyspIHtcbiAgICBjb25zdCBwcmV2aW91c0J1Y2tldFJlZlBvaW50ID0gd2F2ZUZvcm1EYXRhW2xhc3RTZWxlY3RlZFBvaW50SW5kZXhdO1xuICAgIGNvbnN0IG5leHRCdWNrZXRNZWFuID0gZ2V0TmV4dEJ1Y2tldE1lYW4oXG4gICAgICB3YXZlRm9ybURhdGEsXG4gICAgICBidWNrZXRJbmRleCxcbiAgICAgIGJ1Y2tldFNpemVcbiAgICApO1xuXG4gICAgY29uc3QgY3VycmVudEJ1Y2tldFN0YXJ0SW5kZXggPVxuICAgICAgTWF0aC5mbG9vcigoYnVja2V0SW5kZXggLSAxKSAqIGJ1Y2tldFNpemUpICsgMTtcbiAgICBjb25zdCBuZXh0QnVja2V0U3RhcnRJbmRleCA9IE1hdGguZmxvb3IoYnVja2V0SW5kZXggKiBidWNrZXRTaXplKSArIDE7XG4gICAgY29uc3QgY291bnRVbml0c0JldHdlZW5BdG9DID1cbiAgICAgIDEgKyBuZXh0QnVja2V0U3RhcnRJbmRleCAtIGN1cnJlbnRCdWNrZXRTdGFydEluZGV4O1xuXG4gICAgbWF4QXJlYSA9IHRyaWFuZ2xlQXJlYSA9IC0xO1xuXG4gICAgZm9yIChcbiAgICAgIGxldCBjdXJyZW50UG9pbnRJbmRleCA9IGN1cnJlbnRCdWNrZXRTdGFydEluZGV4O1xuICAgICAgY3VycmVudFBvaW50SW5kZXggPCBuZXh0QnVja2V0U3RhcnRJbmRleDtcbiAgICAgIGN1cnJlbnRQb2ludEluZGV4KytcbiAgICApIHtcbiAgICAgIGNvbnN0IGNvdW50VW5pdHNCZXR3ZWVuQXRvQiA9XG4gICAgICAgIE1hdGguYWJzKGN1cnJlbnRQb2ludEluZGV4IC0gY3VycmVudEJ1Y2tldFN0YXJ0SW5kZXgpICsgMTtcbiAgICAgIGNvbnN0IGNvdW50VW5pdHNCZXR3ZWVuQnRvQyA9XG4gICAgICAgIGNvdW50VW5pdHNCZXR3ZWVuQXRvQyAtIGNvdW50VW5pdHNCZXR3ZWVuQXRvQjtcbiAgICAgIGNvbnN0IGN1cnJlbnRQb2ludFZhbHVlID0gd2F2ZUZvcm1EYXRhW2N1cnJlbnRQb2ludEluZGV4XTtcblxuICAgICAgdHJpYW5nbGVBcmVhID0gdHJpYW5nbGVBcmVhSGVyb24oXG4gICAgICAgIHRyaWFuZ2xlQmFzZShcbiAgICAgICAgICBNYXRoLmFicyhwcmV2aW91c0J1Y2tldFJlZlBvaW50IC0gY3VycmVudFBvaW50VmFsdWUpLFxuICAgICAgICAgIGNvdW50VW5pdHNCZXR3ZWVuQXRvQlxuICAgICAgICApLFxuICAgICAgICB0cmlhbmdsZUJhc2UoXG4gICAgICAgICAgTWF0aC5hYnMoY3VycmVudFBvaW50VmFsdWUgLSBuZXh0QnVja2V0TWVhbiksXG4gICAgICAgICAgY291bnRVbml0c0JldHdlZW5CdG9DXG4gICAgICAgICksXG4gICAgICAgIHRyaWFuZ2xlQmFzZShcbiAgICAgICAgICBNYXRoLmFicyhwcmV2aW91c0J1Y2tldFJlZlBvaW50IC0gbmV4dEJ1Y2tldE1lYW4pLFxuICAgICAgICAgIGNvdW50VW5pdHNCZXR3ZWVuQXRvQ1xuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBpZiAodHJpYW5nbGVBcmVhID4gbWF4QXJlYSkge1xuICAgICAgICBtYXhBcmVhID0gdHJpYW5nbGVBcmVhO1xuICAgICAgICBtYXhBcmVhUG9pbnQgPSB3YXZlRm9ybURhdGFbY3VycmVudFBvaW50SW5kZXhdO1xuICAgICAgICBsYXN0U2VsZWN0ZWRQb2ludEluZGV4ID0gY3VycmVudFBvaW50SW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBtYXhBcmVhUG9pbnQgIT09ICd1bmRlZmluZWQnKSByZXN1bHQucHVzaChtYXhBcmVhUG9pbnQpO1xuICB9XG5cbiAgcmVzdWx0LnB1c2god2F2ZUZvcm1EYXRhW3dhdmVGb3JtRGF0YS5sZW5ndGggLSAxXSk7IC8vIEFsd2F5cyBhZGQgdGhlIGxhc3QgcG9pbnRcblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgdXBzYW1wbGUgPSAod2F2ZUZvcm1EYXRhOiBudW1iZXJbXSwgc2FtcGxlU2l6ZTogbnVtYmVyKSA9PiB7XG4gIGlmIChzYW1wbGVTaXplID09PSB3YXZlRm9ybURhdGEubGVuZ3RoKSByZXR1cm4gd2F2ZUZvcm1EYXRhO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAgcHJlZmVyLWNvbnN0XG4gIGxldCBbYnVja2V0U2l6ZSwgcmVtYWluZGVyXSA9IGRpdk1vZChzYW1wbGVTaXplLCB3YXZlRm9ybURhdGEubGVuZ3RoKTtcbiAgY29uc3QgcmVzdWx0OiBudW1iZXJbXSA9IFtdO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgd2F2ZUZvcm1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZXh0cmEgPSByZW1haW5kZXIgJiYgcmVtYWluZGVyLS0gPyAxIDogMDtcbiAgICByZXN1bHQucHVzaCguLi5BcnJheTxudW1iZXI+KGJ1Y2tldFNpemUgKyBleHRyYSkuZmlsbCh3YXZlRm9ybURhdGFbaV0pKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgZ2V0TmV4dEJ1Y2tldE1lYW4gPSAoXG4gIGRhdGE6IG51bWJlcltdLFxuICBjdXJyZW50QnVja2V0SW5kZXg6IG51bWJlcixcbiAgYnVja2V0U2l6ZTogbnVtYmVyXG4pID0+IHtcbiAgY29uc3QgbmV4dEJ1Y2tldFN0YXJ0SW5kZXggPSBNYXRoLmZsb29yKGN1cnJlbnRCdWNrZXRJbmRleCAqIGJ1Y2tldFNpemUpICsgMTtcbiAgbGV0IG5leHROZXh0QnVja2V0U3RhcnRJbmRleCA9XG4gICAgTWF0aC5mbG9vcigoY3VycmVudEJ1Y2tldEluZGV4ICsgMSkgKiBidWNrZXRTaXplKSArIDE7XG4gIG5leHROZXh0QnVja2V0U3RhcnRJbmRleCA9XG4gICAgbmV4dE5leHRCdWNrZXRTdGFydEluZGV4IDwgZGF0YS5sZW5ndGhcbiAgICAgID8gbmV4dE5leHRCdWNrZXRTdGFydEluZGV4XG4gICAgICA6IGRhdGEubGVuZ3RoO1xuXG4gIHJldHVybiBtZWFuKGRhdGEuc2xpY2UobmV4dEJ1Y2tldFN0YXJ0SW5kZXgsIG5leHROZXh0QnVja2V0U3RhcnRJbmRleCkpO1xufTtcblxuY29uc3QgbWVhbiA9ICh2YWx1ZXM6IG51bWJlcltdKSA9PlxuICB2YWx1ZXMucmVkdWNlKChhY2MsIHZhbHVlKSA9PiBhY2MgKyB2YWx1ZSwgMCkgLyB2YWx1ZXMubGVuZ3RoO1xuXG5jb25zdCB0cmlhbmdsZUFyZWFIZXJvbiA9IChhOiBudW1iZXIsIGI6IG51bWJlciwgYzogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IHMgPSAoYSArIGIgKyBjKSAvIDI7XG4gIHJldHVybiBNYXRoLnNxcnQocyAqIChzIC0gYSkgKiAocyAtIGIpICogKHMgLSBjKSk7XG59O1xuXG5jb25zdCB0cmlhbmdsZUJhc2UgPSAoYTogbnVtYmVyLCBiOiBudW1iZXIpID0+XG4gIE1hdGguc3FydChNYXRoLnBvdyhhLCAyKSArIE1hdGgucG93KGIsIDIpKTtcblxuY29uc3QgZGl2TW9kID0gKG51bTogbnVtYmVyLCBkaXZpc29yOiBudW1iZXIpID0+IHtcbiAgcmV0dXJuIFtNYXRoLmZsb29yKG51bSAvIGRpdmlzb3IpLCBudW0gJSBkaXZpc29yXTtcbn07XG4iXX0=